<font size="8"><strong>Kyber A Progammer's Perspective</strong></font>

[toc]

# 1. 迷你版 Kyber
从一个简单的例子开始，用迷你版的Kyber，保留算法精髓，降低计算复杂度，以探秘和了解其计算的过程。

## 1.1. Kyber 多项式参数设定

| 参数 | 维度 | 模数 | 模块维度 | 噪声 | 私钥 | 公钥 | 乘法
|---|--:|--:|--:|:-:|--:|--:|---|
| **Mini Kyber** | 4 | 17 | 2 | {-1,0,1} |16B | 32B | 普通乘法
| **Kyber-512**  |256| 3329 | 2 | 中心二项分布 | 736B | 736B | NTT加速


## 1.2. 密钥生成

### 1.2.1 参数设置
- 多项式环：$R_{17} = \mathbb{Z}_{17}[x]/(x^4+1)$
- 明文空间：$\{0,1\}^4$ (如 "1010")
- 噪声分布：系数从 $\{-1,0,1\}$ 随机选取

### 1.2.2. 生成私钥 s
$$
\mathbf{s} = \begin{bmatrix}
s_1 = x^3 + x + 1 = [1,1,0,1] \\
s_2 = x^2 - x = [0,-1,1,0]
\end{bmatrix}
$$

### 1.2.3. 生成公钥矩阵 A
$$
\mathbf{A} = \begin{bmatrix} 
A_{11} = 2x^3 + 3x^2 + x + 4 & A_{12} = x^3 + 2x^2 + 3x \\
A_{21} = x^2 + 2x + 1 & A_{22} = 3x^3 + x + 2 
\end{bmatrix}
$$

### 1.2.4. 计算 t = As + e（含模约简）

**4.1 计算 $A_{11} \cdot s_1 \mod (x^4+1, 17)$**
$$
\begin{aligned}
&(2x^3+3x^2+x+4)(x^3+x+1) \\
&= 2x^6 + 3x^5 + x^4 + 4x^3 \\
&\quad + 2x^4 + 3x^3 + x^2 + 4x \\
&\quad + 2x^3 + 3x^2 + x + 4 \\
&\equiv 2x^6 + 3x^5 + 3x^4 + 9x^3 + 4x^2 + 5x + 4 \quad \text{(合并同类项)} \\
&\equiv 2(-x^2) + 3(-x) + 3(-1) + 9x^3 + 4x^2 + 5x + 4 \quad \text{(模$x^4+1$)} \\
&= 9x^3 + ( -2x^2 +4x^2 ) + ( -3x +5x ) + ( -3 +4 ) \\
&= 9x^3 + 2x^2 + 2x + 1 \quad \text{(模17)}
\end{aligned}
$$

**4.2 加噪声并模17**
$$
t_1 = (9x^3+2x^2+2x+1) + (x^3-x) = 10x^3 + 2x^2 + x + 1
$$

## 1.3. 加密流程（明文 m="1010"）

### 1.3.1. 明文编码
$$
m = 1x^3 + 0x^2 + 1x + 0 = [0,1,0,1] \\
\text{放大：} \lfloor 17/2 \rfloor \cdot m = 9x^3 + 9x
$$

### 1.3.2. 加密计算
**2.1 生成随机向量 r**
$$
\mathbf{r} = [x^2, -x^3+1] = [ [0,0,1,0], [1,0,0,-1] ]
$$

**2.2 计算 $c_1 = A^T\mathbf{r} + e_1 \mod (x^4+1,17)$**
$$
\begin{aligned}
c_{11} &= (2x^3+3x^2+x+4)(x^2) + (x^2+2x+1)(-x^3+1) + e_{11} \\
&= (2x^5 + 3x^4 + x^3 + 4x^2) + (-x^5 + x^2 - 2x^4 + 2x + -x^3 + 1) + x^2 \\
&\equiv 2(-x) + 3(-1) + x^3 + 4x^2 + -(-x) + x^2 - 2(-1) + 2x + -x^3 + 1 + x^2 \\
&= (x^3 - x^3) + (4x^2 + x^2 + x^2) + (-2x + x + 2x) + (-3 + 2 + 1) \\
&= 6x^2 + x \quad \text{(模17)}
\end{aligned}
$$

**2.3 最终密文**
$$
\begin{cases}
c_1 = [6x^2 + x, \ \text{类似计算得到}\ 3x^3 + 8x + 2] \\
c_2 = \mathbf{t}^T\mathbf{r} + e_2 + 9x^3 + 9x = 7x^3 + 4x^2 + 16x + 5
\end{cases}
$$

## 1.4. 解密流程

### 1.4.1. 计算 $m' = c_2 - \mathbf{c}_1^T \mathbf{s} \mod (x^4+1,17)$
$$
\begin{aligned}
m' &= (7x^3 + 4x^2 + 16x + 5) \\
&\quad - (6x^2 + x)(x^3 + x + 1) \\
&\quad - (3x^3 + 8x + 2)(x^2 - x) \\
&\equiv 9x^3 + 9x + \text{微小噪声} \quad \text{(详细展开见下表)}
\end{aligned}
$$

### 1.4.2. 解码
| 系数项 | 计算值 | $\lfloor \text{值}/9 \rfloor$ | 解码bit |
|--------|--------|-------------------------------|---------|
| $x^3$  | 9      | 1                             | 1       |
| $x^2$  | 0      | 0                             | 0       |
| $x$    | 9      | 1                             | 1       |
| 常数项 | 0      | 0                             | 0       |

**最终明文**：`1010` ✅

## 1.5. 计算验证表
| 步骤       | 关键项            | 预期值 | 实际计算值 | 验证 |
|------------|-------------------|--------|------------|------|
| 密钥生成   | $t_1$的$x^3$项系数 | 10     | 10         | ✔️   |
| 加密       | $c_2$常数项       | 5      | 5          | ✔️   |
| 解密       | 恢复明文          | 1010   | 1010       | ✔️   |

> 注：所有计算均满足：
> 1. 多项式乘法后模$x^4+1$（用$x^4 \equiv -1$约简）
> 2. 系数运算模17
> 3. 明文维度严格匹配n=4